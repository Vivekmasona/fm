<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bihar FM Studio</title>

<!-- âœ… Fast Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">

<style>
:root {
  --bg: #0a0a0a;
  --accent: #ff2b2b;
  --text: #f1f1f1;
  --green: #00ff80;
  --red: #ff4040;
}

* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: "Poppins", sans-serif;
  background: var(--bg);
  color: var(--text);
  height: 100vh;
  overflow: hidden;
}

/* ===== HEADER ===== */
header {
  position: fixed;
  top: 0; left: 0;
  width: 100%;
  height: 60px;
  background: #111;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  font-size: 1.4rem;
  letter-spacing: 1px;
  color: var(--accent);
  box-shadow: 0 2px 10px #000;
  z-index: 20;
}
#statusDot {
  position: absolute;
  right: 1rem;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: var(--red);
  box-shadow: 0 0 10px var(--red);
  transition: all 0.3s ease;
}
#statusDot.loading::after {
  content: "";
  position: absolute;
  top: -4px;
  left: -4px;
  width: 22px;
  height: 22px;
  border: 2px solid rgba(255,255,255,0.3);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}
@keyframes spin { 100% { transform: rotate(360deg); } }

/* ===== FOOTER ===== */
footer {
  position: fixed;
  bottom: 0; left: 0;
  width: 100%;
  height: 70px;
  background: #111;
  display: flex;
  justify-content: space-around;
  align-items: center;
  box-shadow: 0 -2px 10px #000;
  z-index: 20;
}

/* ===== SIDEBAR ===== */
.sidebar {
  position: fixed;
  top: 60px;
  bottom: 70px;
  left: 0;
  width: 90px;
  background: #141414;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: space-evenly;
  box-shadow: inset -1px 0 10px #000;
}

.sidebar button {
  background: #1f1f1f;
  border: none;
  color: var(--text);
  font-size: 1.4rem;
  width: 55px;
  height: 55px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: 0.3s;
}
.sidebar button:hover { background: var(--accent); color: #fff; }

.sidebar input[type="range"] {
  writing-mode: bt-lr;
  -webkit-appearance: slider-vertical;
  height: 100px;
  width: 6px;
  accent-color: var(--accent);
}

/* ===== MAIN LIST ===== */
main {
  position: absolute;
  top: 60px;
  bottom: 70px;
  left: 90px;
  right: 0;
  overflow-y: auto;
  padding: 0.8rem;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.song {
  background: #161616;
  border-radius: 8px;
  padding: 0.6rem 0.8rem;
  display: flex;
  align-items: center;
  gap: 10px;
  transition: 0.3s;
  overflow: hidden;
}
.song.active { background: #1f1f1f; border-left: 3px solid var(--accent); }
.song:hover { background: #222; transform: scale(1.01); }

.cover {
  width: 45px;
  height: 45px;
  border-radius: 6px;
  background: #222 center/cover no-repeat;
  flex-shrink: 0;
}

.meta {
  flex: 1;
  overflow: hidden;
}
.title {
  font-weight: 500;
  font-size: 0.9rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.artist {
  font-size: 0.8rem;
  color: #aaa;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.live-badge {
  background: var(--accent);
  color: #fff;
  padding: 3px 7px;
  border-radius: 5px;
  font-size: 0.7rem;
  animation: pulse 1.2s infinite;
}
@keyframes pulse {
  0%,100% { opacity: 1; }
  50% { opacity: 0.4; }
}

/* ===== FOOTER ICONS ===== */
.icon-btn {
  background: #1a1a1a;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text);
  cursor: pointer;
  font-size: 1.3rem;
  transition: 0.3s;
}
.icon-btn:hover { background: var(--accent); color: #fff; }

.live-btn {
  background: #444;
  width: 75px;
  height: 75px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  font-size: 1.8rem;
  cursor: pointer;
  position: relative;
  transition: 0.3s;
}
.live-btn.active {
  background: var(--accent);
  box-shadow: 0 0 15px rgba(255, 43, 43, 0.7);
}
.live-btn.active::before {
  content: "";
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background: rgba(255, 43, 43, 0.4);
  animation: ripple 1.6s infinite;
}
@keyframes ripple {
  0% {transform: scale(1); opacity: 1;}
  100% {transform: scale(2); opacity: 0;}
}

/* ===== SCROLLBAR ===== */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }

/* ===== RESPONSIVE ===== */
@media(max-width:600px){
  .sidebar { width: 70px; }
  main { left: 70px; }
  .live-btn { width: 65px; height: 65px; }
}
</style>
</head>

<body>
  <header>
    Bihar FM Studio
    <div id="statusDot"></div>
  </header>

  <!-- Sidebar -->
  <div class="sidebar">
    <button id="playPause"><i class="fa-solid fa-play"></i></button>
    <input type="range" id="seek" min="0" max="100" value="0">
    <input type="range" id="volume" min="0" max="1" step="0.01" value="0.7">
    <input type="range" id="speed" min="0.5" max="2" step="0.1" value="1">
  </div>

  <!-- Main Playlist -->
  <main id="playlist"></main>

  <!-- Footer -->
  <footer>
    <label for="file" class="icon-btn" title="Upload Songs"><i class="fa-solid fa-upload"></i></label>
    <input id="file" type="file" accept="audio/*" multiple hidden>
    <div class="live-btn" id="goLive"><i class="fa-solid fa-broadcast-tower"></i></div>
    <div class="icon-btn" id="micBtn" title="Mic"><i class="fa-solid fa-microphone"></i></div>
    <div class="icon-btn" id="reconnectBtn" title="Reconnect"><i class="fa-solid fa-rotate-right"></i></div>
  </footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jsmediatags/3.9.5/jsmediatags.min.js"></script>
<script>
const socket = new WebSocket("wss://fmconnector.onrender.com");
const fileEl = document.getElementById("file");
const playlistEl = document.getElementById("playlist");
const playBtn = document.getElementById("playPause");
const statusDot = document.getElementById("statusDot");
const reconnectBtn = document.getElementById("reconnectBtn");
const goLive = document.getElementById("goLive");
const seek = document.getElementById("seek");
const volume = document.getElementById("volume");
const speed = document.getElementById("speed");

const player = new Audio();
let playlist = [];
let index = 0;
let playing = false;

// ===== SOCKET STATUS DOT =====
socket.onopen = () => setConnected(true);
socket.onclose = () => setConnected(false);
function setConnected(state){
  if(state){
    statusDot.classList.remove("loading");
    statusDot.style.background = "var(--green)";
    statusDot.style.boxShadow = "0 0 10px var(--green)";
  } else {
    statusDot.classList.add("loading");
    statusDot.style.background = "var(--red)";
    statusDot.style.boxShadow = "0 0 10px var(--red)";
  }
}
reconnectBtn.onclick = () => {
  setConnected(false);
  setTimeout(()=>setConnected(true),1500);
};

// ===== UPLOAD SONGS + META =====
fileEl.onchange = () => {
  playlist = Array.from(fileEl.files);
  playlistEl.innerHTML = "";
  playlist.forEach((file, i)=>{
    const div = document.createElement("div");
    div.className = "song";
    const cover = document.createElement("div");
    cover.className = "cover";
    const meta = document.createElement("div");
    meta.className = "meta";
    const title = document.createElement("div");
    title.className = "title";
    const artist = document.createElement("div");
    artist.className = "artist";

    title.textContent = file.name.replace(/\.[^/.]+$/, "");
    artist.textContent = "Unknown Artist";
    meta.appendChild(title);
    meta.appendChild(artist);
    div.appendChild(cover);
    div.appendChild(meta);
    div.onclick = ()=>playSong(i);
    playlistEl.appendChild(div);

    // Extract tags
    jsmediatags.read(file, {
      onSuccess: tag => {
        const t = tag.tags;
        title.textContent = t.title || file.name;
        artist.textContent = t.artist || "Unknown Artist";
        if(t.picture){
          const data = t.picture.data;
          const format = t.picture.format;
          let base64 = "";
          for(let j=0;j<data.length;j++) base64 += String.fromCharCode(data[j]);
          cover.style.backgroundImage = `url(data:${format};base64,${btoa(base64)})`;
        }
      },
      onError: err => console.log(err)
    });
  });
};

// ===== PLAY / PAUSE =====
playBtn.onclick = ()=>{
  if(!player.src) return;
  if(player.paused){ player.play(); playing=true; playBtn.innerHTML='<i class="fa-solid fa-pause"></i>'; }
  else { player.pause(); playing=false; playBtn.innerHTML='<i class="fa-solid fa-play"></i>'; }
};

// ===== SONG PLAY =====
async function playSong(i){
  index = i;
  const file = playlist[i];
  player.src = URL.createObjectURL(file);
  await player.play();
  playing=true;
  playBtn.innerHTML='<i class="fa-solid fa-pause"></i>';
  document.querySelectorAll(".song").forEach(s=>s.classList.remove("active"));
  playlistEl.children[i].classList.add("active");
  updateLiveBadge(i);
}
function updateLiveBadge(i){
  document.querySelectorAll(".song .live-badge").forEach(e=>e.remove());
  const live = document.createElement("div");
  live.className="live-badge";
  live.textContent="LIVE";
  playlistEl.children[i].appendChild(live);
}

// ===== CONTROLS =====
player.ontimeupdate = ()=>{ seek.value = (player.currentTime/player.duration)*100 || 0; };
seek.oninput = ()=>{ player.currentTime = (seek.value/100)*player.duration; };
volume.oninput = ()=>{ player.volume = volume.value; };
speed.oninput = ()=>{ player.playbackRate = speed.value; };

// ===== GO LIVE =====
goLive.onclick = ()=>{
  goLive.classList.toggle("active");
};
</script>
</body>
</html>
