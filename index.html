<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>Bihar FM 007 â€” Live Listener</title>
<style>
:root {
  --accent: #7b5bff;
  --grad: linear-gradient(90deg,#7b5bff,#ff4fa3,#ff884a);
  --text: #ffffff;
  --muted: #aaa;
  --bg: #0c0c15;
  --card: #141428;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{
  font-family:'Poppins',sans-serif;
  background:var(--bg);
  color:var(--text);
  height:100vh;width:100vw;
  display:flex;flex-direction:column;
  align-items:center;justify-content:space-between;
  overflow:hidden;position:relative;
}

/* Header */
header{margin-top:25px;text-align:center;}
h1{font-size:22px;font-weight:600;letter-spacing:1px;margin-bottom:6px;}
.status{
  display:flex;align-items:center;justify-content:center;
  font-size:14px;color:var(--muted);gap:6px;
}
.dot,.spin{
  width:10px;height:10px;border-radius:50%;
}
.dot{background:#00ff99;box-shadow:0 0 8px #00ff99;}
.spin{
  border:2px solid #ff3c3c;border-top-color:transparent;
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg);}}

/* Cover */
.cover{
  position:relative;width:240px;height:240px;
  display:flex;align-items:center;justify-content:center;
  margin-top:20px;
}
.cover img{
  width:100%;height:100%;object-fit:cover;border-radius:50%;
  box-shadow:0 10px 30px rgba(123,91,255,0.35);
}
.circle-time{
  position:absolute;
  width:90px;height:90px;
  background:var(--card);
  border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-weight:600;font-size:18px;
  color:var(--accent);
  box-shadow:0 4px 20px rgba(0,0,0,0.6);
}
.circle-wave{
  position:absolute;inset:0;border-radius:50%;
  background:radial-gradient(circle,rgba(123,91,255,0.2),transparent 70%);
  animation:pulse 3s ease-in-out infinite;
  opacity:0.6;
}
@keyframes pulse{
  0%,100%{transform:scale(1);}
  50%{transform:scale(1.1);}
}

/* Bottom wave footer */
.wave{
  position:absolute;bottom:0;left:0;width:100%;height:100px;
  overflow:hidden;z-index:0;
}
.wave svg{width:100%;height:100%;}
.wave path{
  fill:url(#waveGrad);
  opacity:0.9;
  transform-origin:center;
}
.wave.animate path{
  animation:waveMove 3s ease-in-out infinite;
}
.wave.paused path{
  fill:#22223a;
  animation:none;
}
@keyframes waveMove{
  0%,100%{transform:translateX(0);}
  50%{transform:translateX(-20px);}
}

/* Controls */
.controls{
  display:flex;align-items:center;justify-content:center;
  gap:40px;
  margin-bottom:130px; /* spacing from wave */
  z-index:1;
}
.btn{
  width:64px;height:64px;border-radius:22px;
  background:var(--card);
  box-shadow:5px 5px 12px rgba(0,0,0,0.5),
              -5px -5px 12px rgba(255,255,255,0.05);
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;transition:0.2s;
}
.btn:hover{transform:scale(1.07);box-shadow:0 0 15px rgba(123,91,255,0.5);}
.btn svg{width:26px;height:26px;fill:var(--text);}
.play{
  width:88px;height:88px;border-radius:50%;
  background:var(--grad);box-shadow:0 8px 25px rgba(123,91,255,0.4);
}
.play svg{fill:#fff;width:36px;height:36px;}
</style>
</head>
<body>

<header>
  <h1>Bihar FM 007</h1>
  <div class="status"><div class="spin" id="connDot"></div><span id="connText">Connectingâ€¦</span></div>
</header>

<div class="cover">
  <div class="circle-wave"></div>
  <img src="https://images.unsplash.com/photo-1525182008055-f88b95ff7980?q=80&w=800&auto=format&fit=crop" alt="Cover">
  <div class="circle-time" id="timer">00:00</div>
</div>

<!-- bottom footer wave -->
<div class="wave paused" id="bottomWave">
  <svg viewBox="0 0 1440 320" preserveAspectRatio="none">
    <defs>
      <linearGradient id="waveGrad" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" stop-color="#7b5bff"/>
        <stop offset="50%" stop-color="#ff4fa3"/>
        <stop offset="100%" stop-color="#ff884a"/>
      </linearGradient>
    </defs>
    <path d="M0,160 C240,120 480,200 720,160 C960,120 1200,200 1440,160 L1440,320 L0,320 Z"></path>
  </svg>
</div>

<div class="controls">
  <div class="btn" id="shareBtn" title="Share">
    <svg viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7a2.48 2.48 0 000-1.39l7.02-4.11A2.5 2.5 0 1014.5 5a2.5 2.5 0 00.04.42L7.52 9.53a2.5 2.5 0 100 4.94l7.02 4.11a2.5 2.5 0 102.46-2.5z"/></svg>
  </div>
  <div class="btn play" id="playPauseBtn">
    <svg id="playIcon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
    <svg id="pauseIcon" viewBox="0 0 24 24" style="display:none;"><path d="M6 5h4v14H6zM14 5h4v14h-4z"/></svg>
  </div>
  <div class="btn" id="whatsappBtn" title="Chat">
    <svg viewBox="0 0 24 24"><path d="M20.52 3.48A11.85 11.85 0 0012 0C5.37 0 0 5.37 0 12a11.8 11.8 0 001.68 6.05L0 24l6.14-1.6A11.88 11.88 0 0012 24c6.63 0 12-5.37 12-12 0-3.2-1.25-6.22-3.48-8.52zM12 21.7a9.7 9.7 0 01-4.97-1.35l-.36-.21-3.64.95.97-3.55-.24-.37A9.72 9.72 0 1121.7 12 9.7 9.7 0 0112 21.7zm5.23-7.13c-.29-.15-1.72-.84-1.99-.94-.27-.1-.47-.15-.67.15-.2.29-.77.94-.95 1.13-.17.2-.35.22-.64.07-.29-.15-1.22-.45-2.33-1.43a8.65 8.65 0 01-1.6-1.98c-.17-.29-.02-.45.13-.6.14-.14.29-.35.44-.52.15-.17.2-.29.3-.49.1-.2.05-.37-.02-.52-.07-.15-.67-1.62-.92-2.22-.24-.6-.49-.52-.67-.53h-.57c-.2 0-.52.07-.79.37-.27.29-1.04 1.02-1.04 2.49 0 1.47 1.07 2.9 1.22 3.1.15.2 2.1 3.23 5.07 4.53.71.31 1.27.49 1.7.63.71.22 1.35.19 1.86.12.57-.09 1.72-.7 1.96-1.37.24-.67.24-1.24.17-1.37-.07-.14-.26-.22-.55-.37z"/></svg>
  </div>
</div>

<audio id="player" autoplay></audio>

<script>
const WS_URL = "wss://fmconnector.onrender.com";
const connDot = document.getElementById("connDot");
const connText = document.getElementById("connText");
const player = document.getElementById("player");
const playBtn = document.getElementById("playPauseBtn");
const playIcon = document.getElementById("playIcon");
const pauseIcon = document.getElementById("pauseIcon");
const timerEl = document.getElementById("timer");
const bottomWave=document.getElementById("bottomWave");
let pc, playing=false, timerInt;

function setStatus(status,colorState){
  connText.textContent=status;
  connDot.className=colorState==="connected"?"dot":"spin";
}
function fmtTime(s){
  let m=Math.floor(s/60);
  let ss=String(Math.floor(s%60)).padStart(2,"0");
  return `${m}:${ss}`;
}

// WebSocket connect
const socket=new WebSocket(WS_URL);
socket.onopen=()=>{
  socket.send(JSON.stringify({type:"register",role:"listener"}));
  setStatus("Waiting for broadcastâ€¦","loading");
};
socket.onmessage=async e=>{
  const msg=JSON.parse(e.data);
  if(msg.type==="offer"){
    setStatus("Connectingâ€¦","loading");
    pc=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});
    pc.ontrack=ev=>{
      player.srcObject=ev.streams[0];
      setStatus("On Air","connected");
    };
    pc.onicecandidate=ev=>{
      if(ev.candidate)
        socket.send(JSON.stringify({type:"candidate",target:msg.from,payload:ev.candidate}));
    };
    await pc.setRemoteDescription(msg.payload);
    const ans=await pc.createAnswer();
    await pc.setLocalDescription(ans);
    socket.send(JSON.stringify({type:"answer",target:msg.from,payload:ans}));
  }
  if(msg.type==="candidate"&&pc){try{await pc.addIceCandidate(msg.payload);}catch{}}
};

// Play/Pause control
playBtn.onclick=()=>{
  if(playing){player.pause();}else{player.play();}
};
player.onplay=()=>{
  playing=true;
  playIcon.style.display="none";pauseIcon.style.display="block";
  bottomWave.classList.add("animate");
  bottomWave.classList.remove("paused");
  clearInterval(timerInt);
  timerInt=setInterval(()=>timerEl.textContent=fmtTime(player.currentTime),1000);
};
player.onpause=()=>{
  playing=false;
  playIcon.style.display="block";pauseIcon.style.display="none";
  bottomWave.classList.remove("animate");
  bottomWave.classList.add("paused");
  clearInterval(timerInt);
};

// Share + WhatsApp
document.getElementById("shareBtn").onclick=()=>{
  if(navigator.share){
    navigator.share({title:"Bihar FM 007 Live",text:"Listen to Bihar FM Live Broadcast",url:location.href});
  }else{alert("Share not supported on this device");}
};
document.getElementById("whatsappBtn").onclick=()=>{
  window.open("https://wa.me/?text=ðŸŽ§ Listen Bihar FM 007 Live now " + encodeURIComponent(location.href),"_blank");
};
</script>
</body>
</html>
