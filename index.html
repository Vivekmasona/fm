<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BiharFM</title>
  <style>
    body { font-family: sans-serif; background: #000; color: white; text-align: center; }
    .album { width: 180px; height: 180px; border-radius: 50%; object-fit: cover; margin-top: 50px; animation: spin 8s linear infinite; }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    .title { font-size: 1.2em; margin-top: 10px; }
  </style>
</head>
<body>
  <img id="poster" class="album" src="" hidden>
  <div id="title" class="title"></div>
  <audio id="player" controls autoplay></audio>

  <script>
    const ws = new WebSocket((location.protocol === "https:" ? "wss://" : "ws://") + location.host);
    const player = document.getElementById("player");
    const poster = document.getElementById("poster");
    const title = document.getElementById("title");

    ws.onopen = () => ws.send(JSON.stringify({ type: "register", role: "listener" }));

    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      if (data.subtype === "play") {
        title.textContent = data.title;
        poster.src = data.poster;
        poster.hidden = false;
        player.src = data.audio;
        player.playbackRate = data.quality === "high" ? 1.0 : data.quality === "medium" ? 0.95 : 0.9;
        player.play().catch(() => {});
      } else if (data.subtype === "pause") {
        player.pause();
      }
    };
  </script>
</body>
</html>
